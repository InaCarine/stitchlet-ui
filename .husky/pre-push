set -e

# branch_name=$(git rev-parse --abbrev-ref HEAD)

# if [ "$branch_name" = "main" ]; then
#   echo "You can't push directly to main branch."
#   exit 1
# fi

if ! pnpm format:check; then
  echo "Formatting errors! Push denied."
  exit 1
fi

if ! pnpm lint; then
  echo "Linting errors! Push denied."
  exit 1
fi

if ! pnpm check-types; then
  echo "Type errors! Push denied."
  exit 1
fi

if ! pnpm test -- --changedSince=origin/main; then
  echo "Tests failed! Push denied."
  exit 1
fi

exit 0
